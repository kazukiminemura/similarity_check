# Video Similarity with YOLOv8-Pose (Python)

複数の動画の中から、対象動画にポーズ（骨格）の類似度が高い動画を探して表示するシンプルなアプリです。Ultralytics YOLOv8-Pose を使ってフレームごとに骨格を推定し、動画全体の特徴量に集約して類似度（コサイン類似度）を計算します。

## 特徴
- YOLOv8-Pose で人物キーポイントを抽出
- フレーム特徴量（正規化キーポイント）を動画レベル特徴へ集約（平均・分散・モーション）
- コサイン類似度でソートし、上位候補を表示
- 特徴量はキャッシュ（`features_cache/`）して再計算を高速化
- 簡易ビジュアライゼーション（サムネイルに骨格をオーバーレイ）

## セットアップ
1. Python 3.9+ を推奨（Windows 可）
2. 依存ライブラリをインストール

```bash
pip install -r requirements.txt
```

初回実行時に YOLO の重み `yolov8n-pose.pt` が自動ダウンロードされます（ネットワーク接続が必要）。

## 使い方（CLI）
- 対象動画 `--target` と、比較先フォルダ `--candidates` を指定します。
- 上位 K 件を表示（デフォルト 5 件）。

```bash
python -m similarity_check.cli \
  --target path/to/target.mp4 \
  --candidates path/to/video_dir \
  --topk 5 \
  --frame-stride 5 \
  --model yolov8n-pose.pt
```

出力:
- 類似度ランキングをコンソールに表示
- `results_montage.jpg` として上位サムネイルを保存
- `features_cache/` に特徴量を保存（`.npz`）

## 類似度の考え方（概要）
- 各フレームで最も信頼度の高い人物の 17 点キーポイントを取得
- 画像幅高で正規化、重心平行移動＋スケーリングでサイズ差を吸収
- 動画特徴量 = フレーム特徴の「平均」「標準偏差」「フレーム間差分の平均」
- コサイン類似度で動画間の近さを算出（1.0 に近いほど類似）

## よくある質問
- 人物が映っていない/小さい動画は？ → 検出フレームが少ない場合は自動的にスキップ・警告します。
- マルチ人物は？ → 現状は各フレームの最も確からしい 1 人を採用しています。
- 速度違いへの頑健性は？ → 簡易に対応（モーション統計）。より頑健にするには DTW などを追加可能です。

## ライセンス
商用モデルやデータの利用規約はご自身でご確認ください。ソースコードはプロジェクトに含まれるライセンスに準じます。
